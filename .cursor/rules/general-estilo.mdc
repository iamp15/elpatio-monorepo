---
description: Reglas generales de estilo y convenciones para todo el proyecto El Patio
alwaysApply: true
---

# Reglas Generales - El Patio

## üìã Informaci√≥n del Proyecto

Este es un monorepo que incluye:
- **bot-telegram**: Bot de Telegram para gesti√≥n de salas de juego
- **elpatio-backend**: API REST para el backend del sistema
- **elpatio-miniapps**: Mini aplicaciones web para Telegram
- **packages**: Paquetes compartidos entre servicios

## üîß Convenciones de C√≥digo

### Idioma y Comentarios

- **Todos los comentarios y documentaci√≥n en espa√±ol**
- **Nombres de variables y funciones descriptivos en espa√±ol o ingl√©s seg√∫n el contexto**
- Comentarios JSDoc para funciones complejas explicando prop√≥sito, par√°metros y retornos
- Comentarios inline solo cuando sea necesario para explicar l√≥gica compleja

### Estilo de C√≥digo

- Usar **CommonJS** (require/module.exports) para m√≥dulos
- Preferir **async/await** sobre Promises.then()
- Usar **const** por defecto, **let** solo cuando sea necesario, evitar **var**
- Mantener funciones peque√±as con una sola responsabilidad
- Seguir principios **SOLID** y **Clean Code**
- Evitar c√≥digo duplicado (DRY - Don't Repeat Yourself)

### Manejo de Errores

- Siempre incluir manejo de errores apropiado con try-catch
- Usar console.log con emojis para logs informativos (‚úÖ, ‚ùå, ‚ö†Ô∏è, üõë, üîÑ, etc.)
- Evitar console.log en producci√≥n, usar sistema de logging apropiado
- Manejar errores no capturados en procesos (uncaughtException, unhandledRejection)
- Implementar shutdown graceful para servicios

### Estructura de Archivos

- Cada m√≥dulo debe tener su propio README.md explicando su prop√≥sito
- Configuraci√≥n centralizada en carpeta `config/`
- Utilidades comunes en carpeta `utils/`
- Separar responsabilidades en m√≥dulos independientes
- Preferir arquitectura modular sobre archivos monol√≠ticos.
- Monitorear que un m√≥dulo no crezca demasiado (m√°s de 600 lineas) y cuando ocurra sugerir subdivisi√≥n del mismo.

### Variables de Entorno

- Usar **dotenv** para carga de variables de entorno
- Validar variables de entorno requeridas al inicio
- Proporcionar valores por defecto cuando sea apropiado
- Documentar variables de entorno en archivos `.env.example`

### Nombres y Nomenclatura

- **Archivos**: camelCase para JavaScript (ej: `userState.js`, `backendAPI.js`)
- **Carpetas**: kebab-case o camelCase seg√∫n convenci√≥n del m√≥dulo
- **Funciones**: camelCase (ej: `getUserInfo`, `handleCallback`)
- **Constantes**: UPPER_SNAKE_CASE (ej: `MAX_RETRIES`, `API_BASE_URL`)
- **Clases**: PascalCase (ej: `AuthManager`, `BackendAPI`)

## üèóÔ∏è Arquitectura

### Principios de Dise√±o

- **Separaci√≥n de responsabilidades**: Cada m√≥dulo debe tener una responsabilidad clara
- **Modularidad**: Dividir c√≥digo en m√≥dulos peque√±os y reutilizables
- **Configuraci√≥n centralizada**: Un solo lugar para configuraciones
- **Abstracci√≥n**: Usar interfaces/abstracciones para servicios compartidos

### Estructura Recomendada por M√≥dulo

```
modulo/
‚îú‚îÄ‚îÄ config/          # Configuraci√≥n
‚îú‚îÄ‚îÄ handlers/        # Manejadores de eventos (si aplica)
‚îú‚îÄ‚îÄ utils/           # Utilidades
‚îú‚îÄ‚îÄ docs/            # Documentaci√≥n espec√≠fica
‚îú‚îÄ‚îÄ index.js         # Punto de entrada principal
‚îî‚îÄ‚îÄ README.md        # Documentaci√≥n del m√≥dulo
```

## üîí Seguridad

- Validar todas las entradas de usuario
- Usar autenticaci√≥n JWT para rutas protegidas
- No exponer informaci√≥n sensible en logs
- Sanitizar datos antes de guardar en base de datos
- Usar variables de entorno para secretos y tokens

## üì¶ Dependencias

- Node.js >= 18.0.0
- npm >= 8.0.0
- Preferir dependencias estables y mantenidas
- Documentar dependencias cr√≠ticas en README

## üöÄ Git y Commits

- Mensajes de commit en espa√±ol
- Usar commits descriptivos y at√≥micos
- No committear archivos temporales, node_modules, o archivos de configuraci√≥n local
- Usar .gitignore apropiado para cada m√≥dulo
- El repositorio principal del proyecto es elpatio-monorepo
- Los sub-modulos son elpatio-backend, elpatio-miniapps y elpatio-bot-telegram
- Los commits son espec√≠ficos por m√≥dulo. Utilizar los scripts (ubicados en la carpeta scripts) apropiados para cada commit


## ‚úÖ Testing y Calidad

- Escribir c√≥digo pensando en la testabilidad
- Preferir funciones puras cuando sea posible
- Documentar funciones complejas para facilitar testing
- Mantener c√≥digo legible y mantenible

## La consola
- Cuando se ejecuten multiples comandos en la consola solo es v√°lido utilizar como separador de comandos el punto y coma (;)
- El separador de comandos "&&" no es v√°lido.